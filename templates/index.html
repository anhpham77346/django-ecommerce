{% extends 'base.html' %}
{% load humanize %}

{% block title %}
  MegaMarket - Cửa hàng sách trực tuyến
{% endblock %}

{% block extra_css %}
  <style>
    .hero-section {
      height: 100vh;
      background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1507842217343-583bb7270b66') center/cover;
      margin-top: -76px; /* Adjust based on your navbar height */
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
      padding: 0 20px;
    }
    
    .hero-content {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .hero-title {
      font-size: 4rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .hero-description {
      font-size: 1.5rem;
      margin-bottom: 2rem;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    .hero-button {
      padding: 15px 40px;
      font-size: 1.2rem;
      border-radius: 50px;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      background: white;
      color: #333;
      border: 2px solid white;
    }
    
    .hero-button:hover {
      background: transparent;
      color: white;
    }
    
    .product-card {
      transition: all 0.3s;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .card-img-top {
      height: 300px;
      overflow: hidden;
    }
    
    .card-img-top img {
      height: 100%;
      object-fit: cover;
    }
    
    .hover-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .product-card:hover .hover-overlay {
      opacity: 1;
    }
  </style>
{% endblock %}

{% block content %}
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">MegaMarket Books</h1>
      <p class="hero-description">Khám phá kho tàng tri thức với hàng ngàn đầu sách chất lượng</p>
      <a href="#products" class="btn hero-button">Khám phá ngay</a>
    </div>
  </div>

  <div class="container mt-4" id="products">
    <!-- Products Grid -->
    <div class="row g-4">
      {% for book in books %}
        <div class="col-md-3">
          <div class="card product-card h-100">
            <div class="card-img-top position-relative">
              {% comment %} <img src="{{ book.image_url|default:'https://via.placeholder.com/200x300' }}" class="img-fluid" alt="{{ book.title }}" /> {% endcomment %}
              <div class="hover-overlay">
                <button class="btn btn-primary add-to-cart" data-book-id="{{ book.id }}"><i class="bi bi-cart-plus"></i> Thêm vào giỏ</button>
              </div>
            </div>
            <div class="card-body">
              <h5 class="card-title text-truncate">{{ book.title }}</h5>
              <p class="card-text text-muted mb-1">{{ book.author }}</p>
              <div class="d-flex justify-content-between align-items-center">
                <div class="price-block">
                  <span class="card-text fw-bold text-primary h5">
                    {% if book.price %}
                      {{ book.price|floatformat:0|intcomma }}₫
                    {% else %}
                      Liên hệ
                    {% endif %}
                  </span>
                  {% if book.original_price and book.original_price > book.price %}
                    <small class="text-muted text-decoration-line-through ms-2">{{ book.original_price|floatformat:0|intcomma }}₫</small>
                  {% endif %}
                </div>
                {% if book.discount_percent %}
                  <span class="badge bg-danger">-{{ book.discount_percent }}%</span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12 text-center">
          <p class="lead text-muted">Chưa có sách nào trong hệ thống.</p>
        </div>
      {% endfor %}
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.add-to-cart').forEach((button) => {
        button.addEventListener('click', function () {
          const bookId = this.getAttribute('data-book-id')
          fetch(`cart/add-to-cart/${bookId}/`, {
            method: 'GET',
            headers: {
              'X-Requested-With': 'XMLHttpRequest'
            }
          })
            .then((response) => response.json())
            .then((data) => alert(data.error || data.message))
        })
      })
    })
  </script>
{% endblock %}
