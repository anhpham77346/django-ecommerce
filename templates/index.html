{% extends 'base.html' %}

{% block title %}
  MegaMarket - Cửa hàng sách trực tuyến
{% endblock %}

{% block extra_css %}
  <style>
    .hero-section {
      height: 500px;
      background: url('https://images.unsplash.com/photo-1507842217343-583bb7270b66') center/cover;
      margin-top: -24px;
    }
    
    .hero-img-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
    }
    
    .product-card {
      transition: all 0.3s;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .card-img-top {
      height: 300px;
      overflow: hidden;
    }
    
    .card-img-top img {
      height: 100%;
      object-fit: cover;
    }
    
    .hover-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .product-card:hover .hover-overlay {
      opacity: 1;
    }
  </style>
{% endblock %}

{% block content %}
  <!-- Hero Section -->
  <div class="hero-section position-relative mb-5">
    {% comment %} <div class="hero-img-overlay"></div> {% endcomment %}
    <div class="container h-100">
      <div class="row h-100 align-items-center">
        <div class="col-md-6 text-white">
          <h1 class="display-4 fw-bold">MegaMarket Books</h1>
          <p class="lead">Khám phá kho tàng tri thức với hàng ngàn đầu sách chất lượng</p>
          <a href="#products" class="btn btn-light btn-lg">Khám phá ngay</a>
        </div>
      </div>
    </div>
  </div>

  <div class="container" id="products">
    <!-- Products Grid -->
    <div class="row g-4">
      {% for book in books %}
        <div class="col-md-3">
          <div class="card product-card h-100">
            <div class="card-img-top position-relative">
              {% comment %} <img src="{{ book.image_url|default:'https://via.placeholder.com/200x300' }}" class="img-fluid" alt="{{ book.title }}" /> {% endcomment %}
              <div class="hover-overlay">
                <button class="btn btn-primary add-to-cart" data-book-id="{{ book.id }}"><i class="bi bi-cart-plus"></i> Thêm vào giỏ</button>
              </div>
            </div>
            <div class="card-body">
              <h5 class="card-title text-truncate">{{ book.title }}</h5>
              <p class="card-text text-muted mb-1">{{ book.author }}</p>
              <p class="card-text fw-bold text-primary">{{ book.price }} VND</p>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12 text-center">
          <p class="lead text-muted">Chưa có sách nào trong hệ thống.</p>
        </div>
      {% endfor %}
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.add-to-cart').forEach((button) => {
        button.addEventListener('click', function () {
          const bookId = this.getAttribute('data-book-id')
          fetch(`cart/add-to-cart/${bookId}/`, {
            method: 'GET',
            headers: {
              'X-Requested-With': 'XMLHttpRequest'
            }
          })
            .then((response) => response.json())
            .then((data) => alert(data.error || data.message))
        })
      })
    })
  </script>
{% endblock %}
